# Functional Programming in Luclin2

å³ä½¿åœ¨ä¸šåŠ¡æè¿°å±‚é¢ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„æ€è·¯ä¹Ÿèƒ½æä¾›è®¸å¤šä¾¿åˆ©ã€‚ä¾‹å¦‚ä¸éœ€è¦ä»ä¸€å¼€å§‹å°±æ¶æ„ä¸€ä¸ªåºå¤§çš„ç±»ç»“æ„ä½“ç³»ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒä¹‹å‰çŠ¯çš„é”™è¯¯åœ¨åæœŸçº æ­£æ—¶é¢ä¸´å·¨å¤§çš„é‡æ„é™¤é”™å‹åŠ›ã€‚ä½ è¦é¢å¯¹çš„ä»…ä»…æ˜¯é’ˆå¯¹ç±»å‹æ„å»ºä¸€ç³»åˆ—å‡½æ•°å·¥å…·ï¼Œé€šè¿‡æ‹¼è£…ç»„åˆè¿™äº›å·¥å…·æ¥å®ç°ä¸šåŠ¡ç›®æ ‡ã€‚

> å½“è¯»å®Œæœ¬ç« æ–‡æ¡£åå¯ä»¥å›æ¥å“å‘³è¿™æ®µè¯ï¼šåœ¨Luclin2çš„ç³»ç»Ÿä¸­`CaseClass`æ˜¯å¯ä»¥ç”¨æ¥å®ç°ç±»å‹å’Œå€¼çš„è„±æœºè½¬ç§»çš„ã€‚è€Œè¡Œä¸ºçš„è„±æœºè½¬ç§»åˆ™éœ€è¦ç”¨åˆ°ä¸‹ä¸€ç« æ‰€è¯´çš„é¢†åŸŸä¸šåŠ¡æ¨¡å‹`Context/Domain`æœºåˆ¶æ¥å®ç°ã€‚

## ä½¿ç”¨ CaseClass

`CaseClass`æ˜¯Luclin2ä¸­å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œå®ƒå°±åƒä¸€ä¸ªå£³ï¼ŒæŠŠéœ€è¦å¤„ç†çš„æ•°æ®åŒ…è£…èµ·æ¥ï¼Œèµ‹ä¸å…¶é¢å¤–çš„æ„ä¹‰ï¼Œæä¾›å¯¹å‡½æ•°å¼ç¼–ç¨‹çš„æ”¯æŒã€‚ä¾‹å¦‚ä½ æœ‰ä¸ªå­—ä¸²`"hello"`ï¼ŒæŠŠå®ƒå˜æˆä¸€ä¸ªCaseClassçš„è¿‡ç¨‹çœ‹èµ·æ¥æ˜¯è¿™æ ·ï¼š

```php
$case = casing('string', "hello");
```

`casing()`æ–¹æ³•å¯ä»¥ç”Ÿæˆä¸€ä¸ªCaseClassï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸€ä¸ªCaseä¼šåŒ…æ‹¬å…¶ç±»å‹å’Œå†…éƒ¨åŒ…å«çš„å…·ä½“å€¼/å˜é‡å¼•ç”¨ã€‚caseçš„ç±»å‹å³`case type`ï¼Œè¿™æ˜¯ä¸ªéœ€è¦è®°ä½çš„æ¦‚å¿µã€‚éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯ä»¥è·å–ä¸€ä¸ªæ²¡æœ‰åŒ…å«å€¼çš„caseï¼Œè¿™è®©å®ƒçœ‹èµ·æ¥æ›´åƒå…¶ä»–è¯­è¨€ä¸­çš„ç¬¦å·`symbol`ï¼š

```php
$some = casing('some');
$none = casing('none');
```

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡Scalaä¸­çš„å‘½åæ–¹å¼ï¼Œå¹¶ä¸”æœ‰äº›æ¥è¿‘Scalaã€OCamlã€Haskellç­‰ä¸­çš„æ¦‚å¿µï¼Œè¯·ä»å°±ä¸è¦å°†ä»–ä»¬å®Œå…¨åˆ’ä¸Šç­‰å·ï¼Œåœ¨ä¹‹åçš„ç¤ºä¾‹ä¸­ä½ ä¼šçœ‹åˆ°ä¸å°‘åŒºåˆ«ã€‚

ä¸€ä¸ªç‰¹åˆ«çš„åœ°æ–¹æ˜¯ï¼Œcaseæ˜¯è‡ªå¸¦è§£åŒ…çš„ï¼Œæ‰€æœ‰çš„caseå¯¹è±¡éƒ½æœ‰åŒæ ·çš„è§£åŒ…æ–¹å¼ï¼š

```php
$case   = casing('string', "hello");
$value  = $case(); // $value = "hello"
```

é»˜è®¤çš„è§£åŒ…ä¼šè¿”å›åŸå§‹å€¼ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¦å¤„ç†å‡½æ•°çš„caseï¼š

```php
$case = casing('double', 1, fn($v) => $v * 2);
$doubled = $case(); // $doubled = 2
```

å¤„ç†å‡½æ•°å¯ä»¥æ”¯æŒå¤šä¸ªå‚æ•°ï¼Œcaseå†…åŒ…å«çš„å€¼å§‹ç»ˆä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼Œæ¯”å¦‚æ”¹è¿›ä¸€ä¸‹ï¼š

```php
$case = casing('times', 1, fn($v, int $factor) => $v * $factor);
$tripled = $case(3); // $tripled = 3
```

**caseä¸å¯ä»¥è¢«åµŒå¥—**ï¼Œå› æ­¤å½“ä¸€ä¸ªcaseä½œä¸ºå€¼è¢«æ”¾å…¥å¦ä¸€ä¸ªcaseä¸­æ—¶ï¼Œä¼šè§£åŒ…åŸæ¥çš„caseä¸­çš„valueã€‚è¿™å¯ä»¥ç”¨äºåšä¾¿æ·çš„case typeè½¬æ¢ï¼š

```php
$caseA = case('a', 100, fn($v) => $v * 10);
$caseB = case('b', $caseA);
$newValue = $caseB(); // $newValue = 1000, not $caseA
```

> å½“ç¡®å®éœ€è¦è¦ä¸€ä¸ªcaseçš„å¤„ç†å‡½æ•°ä¸­æŠŠå€¼ä½œä¸ºå¦ä¸€ä¸ªcaseè¿›è¡Œæ“ä½œæ—¶ï¼Œè¯·åœ¨å¤„ç†å‡½æ•°ä¸­è‡ªè¡Œè°ƒç”¨`casing()`å‡½æ•°è½¬æ¢ã€‚

å¯ä»¥åŸºäºä¸€ä¸ªcaseè¿›è¡Œç»§æ‰¿åˆ›å»ºï¼Œæ–°çš„caseä¼šç»§æ‰¿è€caseçš„typeï¼Œè®¡ç®—åvalueä»¥åŠå¤„ç†å‡½æ•°ï¼š

```php
$case1 = casing('double', 1, fn($v) => $v * 2);
$case2 = casing($case1);
$doubled  = $case1(); // $doubled = 2
$again    = $case2(); // $again = 4
```

> æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰çœŸçš„å»ç”Ÿæˆä¸€ä¸ªé“¾å¼è°ƒç”¨ï¼Œå½“æ‰§è¡Œ`$case2 = casing($case1)`çš„æ—¶å€™å·²ç»è®¡ç®—è¿‡ä¸€é$case1ä¸­çš„å€¼äº†ã€‚

### åŸå§‹ç±»å‹ raw case

æœ‰æ—¶æˆ‘ä»¬åªæ˜¯æƒ³æŠŠä¸€äº›åŸºç¡€çš„ç±»å‹å°è£…èµ·æ¥ä»¥ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹èƒ½åŠ›ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨`raw()`å‡½æ•°å¯¹å€¼/å˜é‡è¿›è¡ŒåŒ…è£…ã€‚

```php
$case = raw('hello');
```

è¿™æ—¶å¾—åˆ°çš„`case type`æ˜¯`string`ã€‚è¿™ä¸ªç±»å‹åˆ†ææœºåˆ¶ä»å®ç”¨è§’åº¦å‡ºå‘ï¼Œä¸phpåŸç”Ÿçš„ç±»å‹å¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œä¸‹é¢åˆ—å‡ºå½“å‰çš„è½¬æ¢è§„åˆ™ã€‚

```php
function type($var): ?string
{
    if (is_string($var))    return "string";
    if (is_numeric($var))   return "numeric";
    if (is_bool($var))      return "boolean";
    if (is_null($var))      return "null";
    if (is_iterable($var))  return "iterable";
    if (is_resource($var))  return "resource";
    if (is_object($var))    return "instance";
    return null;
}
```

!> Luclin2æ­£åœ¨å¼€å‘ä¸­ï¼Œè¿™éƒ¨åˆ†è½¬æ¢è§„åˆ™å¯èƒ½ä¼šæœ‰æ‰€å˜åŠ¨ï¼Œå¾…1.0 releaseåæ‰ä¼šæ­£å¼å›ºå®šã€‚æ¬²äº†è§£å…·ä½“è®¡ç®—æ–¹å¼è¯·æŸ¥çœ‹é¡¹ç›®ä¸­`casetype()`å‡½æ•°æºç ã€‚

### case type çš„è·å–å’Œæ¯”è¾ƒ

ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è·å–å’Œæ¯”è¾ƒä¸€ä¸ªcaseçš„type

```php
$case1 = raw(1);
$case2 = casing('numeric', 2);

$case1->is($case2->type); // true
```

### case çš„å­—ä¸²åŒ–

ä¸€ä¸ªcaseå¯ä»¥è½¬æ¢ä¸ºå­—ä¸²ï¼Œè½¬æ¢åçš„çº¦å®šç»“æ„å¦‚ä¸‹ï¼š

```php
$some = casing('some', 100);
$none = casing('none');

echo "$some"; // output ":some(100)"
echo "$none"; // output ":none"
```

å¯¹è½¬æ¢åçš„å­—ä¸²å¯ä»¥ç›´æ¥é€šè¿‡`casing()`å‡½æ•°æ¢å¤ä¸ºcaseï¼Œä½†ä¸æ”¯æŒå¯¹å¤„ç†å‡½æ•°åšæ¢å¤ï¼š

```php
$some = casing('some(100)');
$none = casing('none');
```

å¦‚æœcaseä¸­åŒ…å«çš„æ•°æ®æ˜¯å¤æ‚ç»“æ„ï¼Œåœ¨åºåˆ—åŒ–çš„æ—¶å€™è¯¥ç»“æ„è‡ªèº«éœ€è¦å®ç°`__toString()`æ–¹æ³•ã€‚è€Œåœ¨æ¢å¤çš„æ—¶å€™åˆ™éœ€è¦åœ¨è¯¥case typeä¸‹äº‹å…ˆæ³¨å†Œçº¦å®šçš„éšå¼æ–¹æ³•`_restore`ï¼Œè¿™æ ·å½“æ¢å¤æ—¶å…¶è§£æå‡ºæ¥çš„å€¼ä¼šè¢«æ­£ç¡®è¿˜åŸï¼š

```php
// åˆ›å»ºç¤ºèŒƒå¯¹è±¡
class Url {
    public string $url;

    public function __construct(string $url) {
        $this->url = $url;
    }

    public static function restore(string $str): self {
        return new self(urldecode($str));
    }

    public function __toString() {
        return urlencode($this->url);
    }
}

$url = new Url('https://www.php.net/');

// éšå¼æ–¹æ³•å£°æ˜
implicit('url')
    ->_restore(fn(string $str) => Url::restore($str));

// åˆ›å»ºcaseå¹¶åºåˆ—åŒ–
$case = casing('url', $url);
$serialized = "$case"; // $serialized = ':url(https%3A%2F%2Fwww.php.net%2F)'

// ååºåˆ—åŒ–è¿˜åŸcase
$case = casing($serialized);
$url = $case(); // same as new Url('https://www.php.net/')
```

> éšå¼æ–¹æ³•ç›¸å…³æ“ä½œè§åæ–‡è¯¦è¿°ã€‚

## æ¨¡å¼åŒ¹é… Match

æœ‰äº†CaseClasså°±å¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å®ç°æµç¨‹æ§åˆ¶ï¼Œåœ¨è¿™é‡Œæˆ‘ç›´æ¥ä¸¾ä¸€ä¸ªç°å®ä¸€äº›çš„ä¾‹å­ï¼Œä¹Ÿå¯ä»¥çœ‹å‡ºå’Œå…¶ä»–ç›´æ¥æ”¯æŒFPçš„è¯­è¨€çš„å·®å¼‚æ€§ã€‚

?> å‡è®¾è¿™é‡Œéœ€è¦å®ç°æŸ¥è¯¢å™¨ç”Ÿæˆï¼Œå½“ç”¨æˆ·ä¼ å…¥`name=Lucy`æ—¶ä½œä¸ºç›¸ç­‰æ¡ä»¶æŸ¥è¯¢ï¼›ä¼ å…¥`name=:none`æ—¶æŸ¥è¯¢`name is null`ï¼›è€Œä¼ å…¥`name=:some`çš„æ—¶å€™æŸ¥è¯¢`name is not null`ã€‚æ¼”ç¤ºæ‰€ç”¨æŸ¥è¯¢å™¨å€Ÿç”¨Laravelåº“çš„è¯­æ³•ã€‚

```php
$field  = 'name';
$value  = ':some'; // or ':none' or 'Lucy' ..etc

$query = Models\User::query();

$match = match()
    ->some(fn($_) => $query->whereNotNull($field))
    ->none(fn($_) => $query->whereNull($field))
    ->_(fn($case) => $query->where($field, $case()));
$query = $match($value);

$user = $query->first();
```

ä¸Šé¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªæ¨¡å¼åŒ¹é…ï¼Œå¾—åˆ°äº†ä¸€ä¸ªé—­åŒ…ã€‚åœ¨å…·ä½“éœ€è¦åŒ¹é…çš„åœºåˆï¼Œå¯ä»¥æ ¹æ®caseæ‰§è¡Œç›¸åº”çš„ä»£ç åˆ†æ”¯ã€‚

> å‡½æ•°å¼ç¼–ç¨‹ä¸­ç›¸å¯¹é€šç”¨çš„çº¦å®šï¼Œå°†`_`å‘½åä½œä¸ºé€šé…æˆ–å¿½ç•¥çš„å˜é‡ä½¿ç”¨ã€‚è¿™é‡Œçš„`$_`å³æ˜ç¡®è¡¨ç¤ºè¯¥å‚æ•°ä¸åœ¨å‡½æ•°ä½“ä¸­è¢«ä½¿ç”¨ã€‚å½“ç„¶ç”±äºphpçš„ç‰¹æ€§ä¹Ÿå¯ä»¥ç›´æ¥ä¸å†™è¯¥å˜é‡ï¼Œä½†æ˜¯åœ¨æŸäº›å¿…å¡«å˜é‡çš„æƒ…å†µä¸‹æ¨èä½¿ç”¨æ­¤è§„åˆ™ã€‚

`match()`æ–¹æ³•æ”¯æŒæ¥æ”¶ä¸€ä¸ªæ•°ç»„ä½œä¸ºåˆå§‹ç¯å¢ƒå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¼šåœ¨åŒ¹é…æˆåŠŸåä½œä¸ºæœ«å°¾å‚æ•°ä¼ ç»™è°ƒç”¨é—­åŒ…ï¼š

```php
$match = match([
    'userId'  => 1,
])->male(fn($_, $context) => "User {$context['userId']} is male.")
    ->female(fn($_, $context) => "User {$context['userId']} is female.");

$sex = casing('female');
echo $match($sex); // output "User 1 is female."
```

`match()`ç”Ÿæˆçš„é—­åŒ…æ”¯æŒå¤šä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½œä¸ºåŒ¹é…å¯¹è±¡ä¼ å…¥ï¼Œå¹¶åœ¨åŒ¹é…æˆåŠŸåä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™åŒ¹é…ä¸Šçš„å‡½æ•°ã€‚å¦‚æœæœ‰æ›´å¤šå‚æ•°ï¼Œè€Œè¿™äº›å‚æ•°ä¼šè¢«å¸¦åœ¨åŒ¹é…å¯¹è±¡ä¹‹åï¼Œcontextä¹‹å‰ä¼ å…¥ï¼š

```php
$match = match(['userId' => 1])
    ->show(fn($case, $p1, $p2, $context) => [$case, $p1, $p2, $context]);
$result = match(casing('show'), 'p1', 'p2');
```

ä¸Šé¢ä¾‹ç¨‹ä¼šæŠŠä¼ å…¥çš„caseï¼Œ"p1"å’Œ"p2"çš„å­—ä¸²ä»¥åŠcontextç»„åˆæˆä¸€ä¸ªæ•°ç»„ä¸€åŒè¿”å›ã€‚

### å°é—­åŒ¹é…

æŸ¥è¯¢å™¨ç”Ÿæˆçš„ä¾‹å­ä¸­æ˜¯ä¸€ä¸ªå°é—­åŒ¹é…ï¼Œåœ¨æ‰€æœ‰çš„é€‰é¡¹æœ€ååŠ ä¸Š`_()`ä¸‹åˆ’çº¿ä½œä¸º`case type`åŒ¹é…ï¼Œè¡¨ç¤ºå½“ä¸Šè¿°æ‰€æœ‰typeéƒ½æœªå‘½ä¸­æ—¶ï¼Œæ‰§è¡Œæ­¤åˆ†æ”¯çš„å‡½æ•°ã€‚

å½“ä¸€ä¸ªmatchæœªå¤„äºå°é—­çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰åŒ¹é…éƒ½æœªå‘½ä¸­æ—¶ä¼šæŠ›å‡º`\UnexpectedValueException`å¼‚å¸¸ã€‚

### ç‰¹æ®Šç±»å‹ :nothing

ä½¿ç”¨`match()`æ–¹æ³•åŒ¹é…çš„å¯¹è±¡å¾€å¾€éƒ½æ˜¯caseï¼Œä½†ä¹Ÿå…è®¸ä½¿ç”¨écaseçš„å€¼/å˜é‡è¿›è¡ŒåŒ¹é…ã€‚è¿™ç§æƒ…å†µä¸‹ä¼šä½¿ç”¨`casetype()`å‡½æ•°è·å–åŒ¹é…çš„å¯¹è±¡çš„åˆ†ç±»ï¼Œ**è€Œä¸ä¼šå°†å…¶åŒ…è£…æˆä¸€ä¸ªcase**ã€‚å½“casetypeæ— æ³•åœ¨è§„åˆ™å†…è·å–å…¶ç±»å‹è¿”å›nullæ—¶ï¼Œä¼šå°†å…¶ä½œä¸ºä¸€ä¸ªåä¸º`nothing`çš„ç‰¹æ®Šcase typeå‚ä¸åŒ¹é…ã€‚

### å‡½æ•°åˆ—è¡¨ funcs ä¸ take()

äº‹å®ä¸Šï¼Œ`match()`ä¹‹åé€šè¿‡overloadingæœºåˆ¶å®ç°çš„åŠ¨æ€è°ƒç”¨æ–¹æ³•æŒ‡å®šçš„åŒ¹é…å‚æ•°æ˜¯æ”¯æŒå¤šä¸ªçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥ä¼ å…¥ä¸€ç»„å‡½æ•°åˆ—è¡¨ï¼ŒLuclin2ä¸­ä½¿ç”¨`funcs`è¡¨è¿°ï¼Œ`funcs`å†…çš„å‡½æ•°å°†è¢«ä¾æ¬¡è°ƒç”¨ã€‚

```php
$match = match()->double(fn($case) => casing($case), fn($case) => casing($case));
$case = casing('double', 1, fn($v) => $v * 2);
echo $match($case)(); // output 4
```

è¿™é‡Œè¦é‡ç‚¹æåˆ°çš„æ˜¯å¯¹`funcs`çš„æ‰§è¡Œæ”¯æŒæ˜¯åŸºäº`take()`å‡½æ•°å®ç°çš„ï¼Œ`take()`æ¥æ”¶ä¸€ä¸ª`funcs`ï¼Œä¸€ä¸ªå€¼åŠä¸€å †å‚æ•°ã€‚è¿™ä¸ªå€¼å°†ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¹‹åæ˜¯åŒä¸€å¥—å‚æ•°åˆ—è¡¨ã€‚åœ¨æ¯ä¸ªå‡½æ•°å¤„ç†ç»“æŸåï¼Œè¯¥å‡½æ•°çš„è¿”å›å€¼ä¼šä½œä¸ºæ–°çš„å€¼ä»£æ›¿æ—§å€¼ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œè€Œåé¢è·Ÿçš„å‚æ•°åˆ—è¡¨ä¸å˜ï¼Œç›´åˆ°åˆ—è¡¨æ‰§è¡Œç»“æŸï¼Œè¿”å›æœ€åçš„ç»“æœã€‚

```php
$funcs = [
    fn($v, $factor)     => $v + $factor,
    fn($v, $_, $factor) => $v - $factor,
    fn($v, $factor)     => $v * $factor,
    fn($v, $_, $factor) => $v / $factor,
];

echo take($funcs, 10, [5, 3]); // output 20
```

!> `take()`è¿™ä¸€æœºåˆ¶åœ¨Luclin2çš„å¾ˆå¤šç³»ç»Ÿä¸­éƒ½ä¼šç”¨åˆ°ï¼Œéœ€è¦é‡ç‚¹ç†è§£ã€‚

## éšå¼æ–¹æ³• Implicit Method

ä½¿ç”¨`implicit()`å‡½æ•°å¯ä»¥åœ¨æŸä¸€`case type`ä¸Šå£°æ˜ä¸€ç»„éšå¼æ–¹æ³•ï¼Œå½“éšå¼æ–¹æ³•å£°æ˜èµ·åˆ°ç¨‹åºç»“æŸä¼šä¸€ç›´æœ‰æ•ˆã€‚é€šè¿‡è¯¥æœºåˆ¶ç»“åˆcaseï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç»™å„ç±»å¯¹è±¡/å˜é‡/å€¼èµ‹äºå…¶åŸä¸å­˜åœ¨çš„æ–¹æ³•ã€‚

```php
implicit('string')
    ->length(fn($case) => strlen($case()));

$case = raw('hello');
echo $case->length(); // output 5
```

éšå¼æ–¹æ³•çš„å‚æ•°ä¼ é€’æœºåˆ¶å’Œ`match()`ä¸€æ ·ï¼Œ$caseæœ¬èº«ä¼šä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼Œè€Œè°ƒç”¨æ—¶èµ‹ä¸çš„å‚æ•°åˆ™ç´§è·Ÿå…¶åã€‚å¦å¤–ï¼Œéšå¼æ–¹æ³•å£°æ˜çš„å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°åˆ—è¡¨`funcs`ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½œä¸ºå¤šä¸ªå‚æ•°ä¸ºä¸€ä¸ªéšå¼æ–¹æ³•æ³¨å†Œä¸€ç»„å‡½æ•°ã€‚

> æ³¨æ„ï¼Œå¦‚æœåœ¨ä¸€ä¸ªcase typeä¸‹è¿ç»­æ³¨å†ŒåŒåæ–¹æ³•ï¼Œåé¢çš„æ³¨å†Œå‡½æ•°ä¼šè¦†ç›–ä¹‹å‰æ³¨å†Œçš„ï¼Œè€Œä¸ä¼šåœ¨`funcs`ä¸­è¿½åŠ ã€‚ä½ å¯ä»¥ä¸€æ¬¡è°ƒç”¨æ³¨å†Œä¸€ç»„å‡½æ•°ï¼Œä½†ä¸èƒ½åˆ†æ‰¹è¿½åŠ ã€‚

### ç®¡é“æ–¹æ³•è°ƒç”¨ Pipeline

å¦‚æœä½ è¯•ç€ä½¿ç”¨caseä½œä¸ºè¿”å›å€¼ï¼Œé‚£ä¹ˆä½ å·²ç»æ‘¸åˆ°äº†å®ç°ç®¡é“è°ƒç”¨çš„é—¨é“ã€‚é¦–å…ˆæ ¹æ®case typeå£°æ˜å„è‡ªçš„éšå¼æ–¹æ³•ï¼Œä¹‹ååœ¨æ–¹æ³•ä¸­æ˜ç¡®è¿”å›çš„æ˜¯ä»€ä¹ˆcase typeï¼Œè¿™æ ·å¯ä»¥è‡ªç„¶è€Œç„¶åœ°å®ç°pipelineæœºåˆ¶ã€‚æˆ‘ä»¬æŠŠä¸Šé¢çš„æ–¹æ³•æ”¹è¿›ä¸€ä¸‹ï¼Œå¢åŠ ä¸€ä¸ªè·å–å­—ä¸²é•¿åº¦åå°†å­—ä¸²é•¿åº¦ä¹˜ä»¥5çš„éœ€æ±‚ã€‚

```php
implicit('string')
    ->length(fn($case) => raw(strlen($case())));
implicit('numeric')
    ->times(fn($case, int $factor) => raw($case() * $factor));

echo raw('hello')
    ->length()
    ->times(5)(); // output 25
```

çœ‹èµ·æ¥éå¸¸è‡ªç„¶ã€‚åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°`raw()`ä¸ºè‡ªç„¶åœ°åˆ›å»ºcaseå¸¦æ¥çš„ä¾¿åˆ©ï¼Œä»¥åŠæœ€å`times()`è¿”å›çš„å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªcaseï¼Œå› æ­¤å¦‚æœè¦è¾“å‡ºå®é™…ç»“æœçš„è¯ï¼Œè¿˜éœ€è¦å¤šåŠ ä¸€ä¸ª`()`ã€‚ä¸ç”¨è§‰å¾—å¥‡æ€ªï¼Œè¿™ä¸ªè¡¨ç¤ºåœ¨ä¸€äº›è¯­è¨€ä¸­ä¹Ÿæœ‰ä½¿ç”¨ä½œä¸º`Unit`çš„æ¦‚å¿µï¼Œè€Œåœ¨`reason`ä¸­ç”šè‡³ä½¿ç”¨`()`æ¥ä½œä¸ºè‡ªåŠ¨æŸ¯é‡ŒåŒ–ç»ˆæ­¢çš„å ä½ç¬¦ã€‚

### å°é—­éšå¼æ–¹æ³•

å½“å°è¯•è°ƒç”¨ä¸€ä¸ªæœªæ³¨å†Œçš„éšå¼æ–¹æ³•æ—¶ä¼šæŠ›å‡º`\OutOfBoundsException`å¼‚å¸¸ï¼Œé™¤éæ³¨å†Œäº†`_()`æ–¹æ³•ã€‚è¿™é€šå¸¸ç”¨æ¥åŸºäºç°æœ‰ç³»ç»Ÿè¿›è¡Œå…œåº•ã€‚æ‹¿Laravelä¸¾ä¾‹ï¼Œè¯¥æ¡†æ¶æœ¬èº«å°±æä¾›äº†è®¸å¤šè¾…åŠ©æ–¹æ³•ï¼Œå¦‚æœcaseä¹Ÿèƒ½åˆ©ç”¨èµ·æ¥å°±å¥½äº†ï¼Œä¸éœ€è¦å…¨éƒ¨éƒ½å°è£…ä¸€éï¼š

```php
use Illuminate\Support\Str;

implicit('string')
    ->_(fn($case, $method, ...$params) => raw(Str::$method($case(), ...$params)));
```

å®Œç¾æå®šï¼Œè¿™æ ·å½“è°ƒç”¨ä¸å­˜åœ¨çš„éšå¼æ–¹æ³•æ—¶å°±ä¼šå»æ‰¾Strå¤„ç†ï¼Œå†æŠ¥é”™å°±äº¤ç»™æ¡†æ¶äº†ã€‚å½“ç„¶è¿™éƒ¨åˆ†ä¹Ÿå¯ä»¥å†™å¾—å¾ˆç»†ï¼Œæ¯”å¦‚åŒæ—¶æ”¯æŒå¤šä¸ªåŸºç¡€åº“æ–¹æ³•ï¼Œæˆ–æ˜¯è‡ªå®šä¹‰æŠ¥é”™ç±»å‹ï¼Œè¿™éƒ½æ˜¯å¯ä»¥åœ¨ä¸€ä¸ªå‡½æ•°å†…å¤„ç†çš„äº‹â€”â€”ä¸€ä¸ªä¸è¡Œå°±ä¸¤ä¸ªğŸ˜

## ä½¿ç”¨å‡½å­ Functor

Luclin2çš„å‡½æ•°åº“æä¾›çš„å‡½å­æ”¯æŒç›¸å¯¹ç‹­ä¹‰ï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯èƒ½æŠŠä¸€ä¸ªå‡½æ•°`fn(x) => y`åº”ç”¨åˆ°ä¸€ä¸ªç¾¤ä¸Šã€‚é‚£ä¹ˆè¿™ä¸ªç¾¤é€šå¸¸æ¥è¯´å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé›†åˆï¼Œæˆ–æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œç­‰ç­‰ç­‰ç­‰ã€‚å› æ­¤åœ¨Luclin2ä¸­ï¼Œå°†Functoræ‹†è§£æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šå‡½æ•°`function`ä¸è§£åŒ…å™¨`handler`

?> è¿˜æ˜¯ä¸¾ä¸ªç²Ÿå­ï¼Œè¯•æƒ³ä¸Šé¢æˆ‘ä»¬å·²ç»æœ‰äº†è®¡ç®—å‡ºä¸€ä¸ªå­—ä¸²é•¿åº¦çš„å‡½æ•°ï¼Œä¹Ÿæœ‰äº†æŠŠæ•°å­—ä¹˜å€æ•°çš„å‡½æ•°ï¼Œå¹¶ä¸”åšè¿‡äº†ä¸€æ¬¡ç»„åˆè¿ç”¨ã€‚ç°åœ¨éœ€è¦å¯¹æ•°æ®åº“ä¸­å–å‡ºçš„ç”¨æˆ·æ¨¡å‹é›†åˆä¸­æ¯ä¸ªç”¨æˆ·ååº”ç”¨è¿™å¥—é€»è¾‘å¹¶è¿”å›ç»“æœé›†ã€‚å¦‚æœæˆ‘ä»¬ç»§ç»­ç”¨Laravelæ¡†æ¶ï¼Œä¼šå‘ç°è¿™é‡Œè‡³å°‘éœ€è¦ç©¿é€ä¸¤å±‚ä¸æ˜¯æˆ‘ä»¬è‡ªå·±ç¼”é€ çš„å°è£…ï¼šç¬¬ä¸€å±‚æŸ¥è¯¢ç»“æœé›†Collectionï¼Œç¬¬äºŒå±‚Modelå¯¹è±¡ã€‚æˆ‘ä»¬å½“ç„¶å¯ä»¥æ‰‹åŠ¨åœ¨**äº‹å‘åœ°**å†™å¾ªç¯Collectionçš„ä»£ç ï¼Œä¹Ÿå¯ä»¥åœ¨**Modelç±»å†…**å¢åŠ ä¸€ä¸ªæ–¹æ³•æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚ä½†æ˜¯è¿™æ ·å…·æœ‰æ˜æ˜¾ä¾µå…¥æ€§å’Œä½å¤ç”¨æ€§çš„å¥—è·¯æ˜æ˜¾ä¸å¤Ÿå‡½æ•°å¼ã€‚

æ¥çœ‹çœ‹Luclin2ä¸­çš„å‡½å­ç»„åˆä¹‹å‰æ‰€è¿°ç‰¹æ€§æ¥å¦‚ä½•åº”å¯¹å§ï¼å‡è®¾æ¨¡å‹å¯¹è±¡`$user->name`å¯ä»¥å–å¾—ç”¨æˆ·åï¼Œé‚£ä¹ˆå®šä¹‰ä¸€ä¸ªå«`user`çš„case typeï¼Œå¹¶æ³¨å…¥éšå¼æ–¹æ³•ï¼š

```php
implicit('user')
    ->nameLengthTimes(fn($case, $factor) => raw($case()->name)
      ->length()
      ->times($factor));

$user = new class{public string $name;}; // æ¨¡æ‹Ÿå–å‡ºçš„Model User
$user->name = 'Triss';
echo casing('user', $user)->nameLengthTimes(5)(); // output 25
```



result
thought
functor

## æŸ¯é‡ŒåŒ– Currying

